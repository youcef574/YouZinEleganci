// Translation data
const translations = {
  fr: {
    'skip-to-content': 'Aller au contenu principal',
    'nav-home': 'Accueil',
    'nav-services': 'Services',
    'nav-pricing': 'Tarifs',
    'nav-about': 'À propos',
    'nav-contact': 'Contact',
    'nav-support': 'Support 24/7',
    'dark-mode-toggle': 'Basculer le mode sombre',
    'login': 'Se connecter',
    'signup': 'S\'inscrire',
    'hero-title': 'Votre Plateforme E-commerce Professionnelle',
    'hero-subtitle': 'Créez des pages de vente exceptionnelles en quelques clics et transformez vos visiteurs en clients fidèles',
    'start-free': 'Commencer Gratuitement',
    'demo': 'Demander une Démo',
    'share-text': 'Partager :',
    'share-whatsapp': 'Partager sur WhatsApp',
    'share-facebook': 'Partager sur Facebook',
    'share-twitter': 'Partager sur Twitter',
    'stats-title': 'Chiffres Clés',
    'merchants': 'Commerçants Actifs',
    'merchants-desc': 'Font confiance à notre plateforme',
    'sales-generated': 'Ventes Générées',
    'sales-desc': 'En dinars algériens',
    'uptime': '% Disponibilité',
    'uptime-desc': 'Garantie de service',
    'support-hours': 'h/24 Support',
    'support-desc': 'Assistance continue',
    'values-title': 'Pourquoi Choisir YouzinElegancia ?',
    'professionalism': 'Professionnalisme',
    'professionalism-desc': 'Solutions e-commerce de niveau entreprise avec des outils avancés',
    'credibility': 'Crédibilité',
    'credibility-desc': 'Plateforme fiable utilisée par des milliers de commerçants algériens',
    'speed': 'Rapidité',
    'speed-desc': 'Déployez votre boutique en ligne en moins de 5 minutes',
    'security': 'Sécurité',
    'security-desc': 'Sécurité bancaire et protection des données garanties',
    'features-title': 'Fonctionnalités Puissantes',
    'landing-pages': 'Pages de Destination',
    'landing-pages-desc': 'Créez des pages de vente optimisées qui convertissent',
    'templates': 'Templates Personnalisables',
    'templates-desc': 'Bibliothèque de templates professionnels prêts à utiliser',
    'analytics': 'Analytics Avancés',
    'analytics-desc': 'Suivez vos performances et optimisez vos conversions',
    'payments': 'Paiements Locaux',
    'payments-desc': 'Intégration avec les systèmes de paiement algériens',
    'support': 'Support 24/7',
    'support-desc': 'Assistance technique disponible à tout moment',
    'optimization': 'Optimisation SEO',
    'optimization-desc': 'Pages optimisées pour les moteurs de recherche',
    'partners-title': 'Nos Partenaires',
    'partners-subtitle': 'Ils nous font confiance pour développer leur business',
    'testimonials-title': 'Ce Que Disent Nos Clients',
    'play-video': 'Lire la vidéo de témoignage',
    'testimonial-role-1': 'Propriétaire, Mode & Style',
    'testimonial-role-2': 'Fondatrice, Beauté Naturelle',
    'testimonial-role-3': 'Gérant, Électronique Plus',
    'testimonial-1': '"YouzinElegancia a transformé mon business. Mes ventes ont augmenté de 300% en 3 mois !"',
    'testimonial-2': '"Interface intuitive et support exceptionnel. Je recommande vivement !"',
    'testimonial-3': '"Grâce à YouzinElegancia, j\'ai pu digitaliser mon commerce traditionnel rapidement."',
    'faq-title': 'Questions Fréquemment Posées',
    'faq-question-1': 'Comment puis-je commencer avec YouzinElegancia ?',
    'faq-answer-1': 'Il vous suffit de vous inscrire gratuitement, choisir un template qui vous convient, personnaliser votre page de vente et publier. Tout le processus prend moins de 10 minutes.',
    'faq-question-2': 'Quels sont les moyens de paiement acceptés ?',
    'faq-answer-2': 'Nous acceptons tous les moyens de paiement algériens : CIB, EDAHABIA, virement bancaire, et paiement à la livraison. L\'intégration est automatique.',
    'faq-question-3': 'Y a-t-il des frais cachés ?',
    'faq-answer-3': 'Non, nos tarifs sont transparents. Vous payez uniquement l\'abonnement mensuel choisi, sans frais cachés ni commissions sur vos ventes.',
    'faq-question-4': 'Puis-je personnaliser entièrement ma page ?',
    'faq-answer-4': 'Absolument ! Vous pouvez modifier les couleurs, polices, images, textes et mise en page selon vos besoins. Notre éditeur visuel rend la personnalisation très simple.',
    'faq-question-5': 'Le support technique est-il vraiment disponible 24/7 ?',
    'faq-answer-5': 'Oui, notre équipe de support est disponible 24h/24 et 7j/7 via chat en direct, email et téléphone. Nous garantissons une réponse en moins de 5 minutes.',
    'newsletter-title': 'Restez Informé des Dernières Nouveautés',
    'newsletter-subtitle': 'Recevez nos conseils e-commerce, nouvelles fonctionnalités et offres exclusives directement dans votre boîte mail.',
    'newsletter-email-placeholder': 'Votre adresse email',
    'newsletter-subscribe': 'S\'abonner',
    'newsletter-privacy': 'En vous abonnant, vous acceptez de recevoir nos emails marketing. Vous pouvez vous désabonner à tout moment.',
    'support-24-7': 'Support 24/7',
    'support-title': 'Nous Sommes Là Pour Vous',
    'support-desc': 'Notre équipe d\'experts est disponible 24h/24 et 7j/7 pour vous accompagner dans votre réussite.',
    'live-chat': 'Chat en Direct',
    'response-time': 'Réponse en moins de 5 minutes',
    'email-support': 'Support Email',
    'email-response': 'Réponse garantie sous 2h',
    'phone-support': 'Support Téléphonique',
    'phone-hours': 'Disponible 24h/24',
    'cta-title': 'Prêt à transformer votre business ?',
    'cta-subtitle': 'Rejoignez plus de 10,000 commerçants algériens qui font confiance à YouzinElegancia',
    'create-account': 'Créer un Compte Gratuit',
    'guarantee': 'Essai gratuit de 14 jours - Sans engagement',
    'footer-desc': 'La plateforme e-commerce leader en Algérie pour créer des pages de vente exceptionnelles.',
    'footer-product': 'Produit',
    'footer-features': 'Fonctionnalités',
    'footer-pricing': 'Tarifs',
    'footer-templates': 'Templates',
    'footer-integrations': 'Intégrations',
    'footer-api': 'API',
    'footer-support': 'Support',
    'footer-help': 'Centre d\'aide',
    'footer-contact': 'Contact',
    'footer-status': 'Statut du service',
    'footer-community': 'Communauté',
    'footer-tutorials': 'Tutoriels',
    'footer-company': 'Entreprise',
    'footer-about': 'À propos',
    'footer-blog': 'Blog',
    'footer-careers': 'Carrières',
    'footer-press': 'Presse',
    'footer-partners': 'Partenaires',
    'footer-legal': 'Légal',
    'footer-privacy': 'Politique de confidentialité',
    'footer-terms': 'Conditions d\'utilisation',
    'footer-cookies': 'Politique des cookies',
    'footer-gdpr': 'RGPD',
    'footer-security': 'Sécurité',
    'footer-rights': 'Tous droits réservés.',
    'sticky-cta-text': 'Créez votre boutique maintenant',
    'create-free-account': 'Créer mon compte gratuitement',
    'name-placeholder': 'Nom complet',
    'email-placeholder': 'Adresse email',
    'password-placeholder': 'Mot de passe',
    'terms-agreement': 'J\'accepte les conditions d\'utilisation et la politique de confidentialité',
    'terms-link': 'conditions d\'utilisation',
    'privacy-link': 'politique de confidentialité',
    'already-member': 'Déjà membre ?',
    'login-here': 'Se connecter ici',
    'remember-me': 'Se souvenir de moi',
    'login-button': 'Se connecter',
    'forgot-password': 'Mot de passe oublié ?',
    'no-account': 'Pas encore de compte ?',
    'signup-here': 'S\'inscrire ici',
    'customer-testimonial': 'Témoignage Client'
  },
  ar: {
    'skip-to-content': 'الانتقال إلى المحتوى الرئيسي',
    'nav-home': 'الرئيسية',
    'nav-services': 'الخدمات',
    'nav-pricing': 'الأسعار',
    'nav-about': 'حولنا',
    'nav-contact': 'اتصل بنا',
    'nav-support': 'دعم 24/7',
    'dark-mode-toggle': 'تبديل الوضع المظلم',
    'login': 'تسجيل الدخول',
    'signup': 'إنشاء حساب',
    'hero-title': 'منصة التجارة الإلكترونية المهنية',
    'hero-subtitle': 'أنشئ صفحات مبيعات استثنائية في دقائق وحول زوارك إلى عملاء مخلصين',
    'start-free': 'ابدأ مجاناً',
    'demo': 'طلب عرض تجريبي',
    'share-text': 'مشاركة:',
    'share-whatsapp': 'مشاركة على واتساب',
    'share-facebook': 'مشاركة على فيسبوك',
    'share-twitter': 'مشاركة على تويتر',
    'stats-title': 'الأرقام الرئيسية',
    'merchants': 'التجار النشطون',
    'merchants-desc': 'يثقون في منصتنا',
    'sales-generated': 'المبيعات المحققة',
    'sales-desc': 'بالدينار الجزائري',
    'uptime': '% التوفر',
    'uptime-desc': 'ضمان الخدمة',
    'support-hours': 'س/24 دعم',
    'support-desc': 'مساعدة مستمرة',
    'values-title': 'لماذا تختار يوزين إليغانسيا؟',
    'professionalism': 'المهنية',
    'professionalism-desc': 'حلول تجارة إلكترونية على مستوى المؤسسات مع أدوات متقدمة',
    'credibility': 'المصداقية',
    'credibility-desc': 'منصة موثوقة يستخدمها آلاف التجار الجزائريين',
    'speed': 'السرعة',
    'speed-desc': 'انشر متجرك الإلكتروني في أقل من 5 دقائق',
    'security': 'الأمان',
    'security-desc': 'أمان مصرفي وحماية البيانات مضمونة',
    'features-title': 'ميزات قوية',
    'landing-pages': 'صفحات الهبوط',
    'landing-pages-desc': 'أنشئ صفحات مبيعات محسنة تحقق التحويل',
    'templates': 'قوالب قابلة للتخصيص',
    'templates-desc': 'مكتبة من القوالب المهنية الجاهزة للاستخدام',
    'analytics': 'تحليلات متقدمة',
    'analytics-desc': 'تتبع أداءك وحسن تحويلاتك',
    'payments': 'مدفوعات محلية',
    'payments-desc': 'تكامل مع أنظمة الدفع الجزائرية',
    'support': 'دعم 24/7',
    'support-desc': 'مساعدة تقنية متاحة في أي وقت',
    'optimization': 'تحسين SEO',
    'optimization-desc': 'صفحات محسنة لمحركات البحث',
    'partners-title': 'شركاؤنا',
    'partners-subtitle': 'يثقون بنا لتطوير أعمالهم',
    'testimonials-title': 'ما يقوله عملاؤنا',
    'play-video': 'تشغيل فيديو الشهادة',
    'testimonial-role-1': 'المالك، الموضة والأناقة',
    'testimonial-role-2': 'المؤسسة، الجمال الطبيعي',
    'testimonial-role-3': 'المدير، الإلكترونيات بلس'
  }
};

// Global variables
let currentLanguage = 'fr';
let isDarkMode = false;
let currentTestimonial = 0;
let testimonialInterval;
let particleAnimation;

// DOM elements
const navbar = document.getElementById('navbar');
const hamburger = document.getElementById('hamburger');
const navMenu = document.getElementById('navMenu');
const darkModeToggle = document.getElementById('darkModeToggle');
const progressBar = document.getElementById('progressBar');
const particles = document.getElementById('particles');
const stickyCta = document.getElementById('stickyCta');

// Modals
const signupModal = document.getElementById('signupModal');
const loginModal = document.getElementById('loginModal');
const videoModal = document.getElementById('videoModal');

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
  initializeApp();
});

function initializeApp() {
  setupEventListeners();
  initializeParticles();
  initializeScrollAnimations();
  initializeTestimonialCarousel();
  initializeFAQ();
  initializeForms();
  initializeCounters();
  initializeTheme();
  initializeTranslations();
  
  // Delayed initializations
  setTimeout(() => {
    initializeScrollProgress();
    initializeStickyCTA();
  }, 1000);
}

function setupEventListeners() {
  // Navigation
  hamburger?.addEventListener('click', toggleMobileMenu);
  
  // Language switching
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => switchLanguage(btn.dataset.lang));
  });
  
  // Dark mode toggle
  darkModeToggle?.addEventListener('click', toggleDarkMode);
  
  // Modal triggers
  document.querySelectorAll('#signupBtn, #heroSignupBtn, #ctaSignupBtn, #stickyCTABtn').forEach(btn => {
    btn.addEventListener('click', () => openModal('signup'));
  });
  
  document.querySelectorAll('#loginBtn, #ctaLoginBtn').forEach(btn => {
    btn.addEventListener('click', () => openModal('login'));
  });
  
  // Modal switching
  document.getElementById('switchToLogin')?.addEventListener('click', (e) => {
    e.preventDefault();
    closeModal('signup');
    openModal('login');
  });
  
  document.getElementById('switchToSignup')?.addEventListener('click', (e) => {
    e.preventDefault();
    closeModal('login');
    openModal('signup');
  });
  
  // Modal close buttons
  document.querySelectorAll('.modal-close, .modal-overlay').forEach(btn => {
    btn.addEventListener('click', (e) => {
      if (e.target === btn) {
        closeAllModals();
      }
    });
  });
  
  // Video testimonials
  document.querySelectorAll('.video-thumbnail').forEach(thumbnail => {
    thumbnail.addEventListener('click', () => {
      const videoId = thumbnail.dataset.videoId;
      openVideoModal(videoId);
    });
  });
  
  // Sticky CTA close
  document.getElementById('stickyCTAClose')?.addEventListener('click', closeStickyCTA);
  
  // Smooth scrolling for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', (e) => {
      e.preventDefault();
      const target = document.querySelector(anchor.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
  
  // Window events
  window.addEventListener('scroll', handleScroll);
  window.addEventListener('resize', handleResize);
  
  // Keyboard events
  document.addEventListener('keydown', handleKeyboard);
}

function toggleMobileMenu() {
  hamburger.classList.toggle('active');
  navMenu.classList.toggle('active');
  
  // Update ARIA attributes
  const isExpanded = navMenu.classList.contains('active');
  hamburger.setAttribute('aria-expanded', isExpanded);
  
  // Prevent body scroll when menu is open
  document.body.style.overflow = isExpanded ? 'hidden' : '';
}

function switchLanguage(lang) {
  if (lang === currentLanguage) return;
  
  currentLanguage = lang;
  
  // Update language buttons
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.lang === lang);
    btn.setAttribute('aria-pressed', btn.dataset.lang === lang);
  });
  
  // Update document direction
  document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
  document.documentElement.lang = lang;
  
  // Update translations
  updateTranslations();
}

function updateTranslations() {
  const elements = document.querySelectorAll('[data-key]');
  elements.forEach(element => {
    const key = element.dataset.key;
    const translation = translations[currentLanguage][key];
    if (translation) {
      if (element.tagName === 'INPUT' && element.placeholder !== undefined) {
        element.placeholder = translation;
      } else {
        element.textContent = translation;
      }
    }
  });
}

function initializeTranslations() {
  updateTranslations();
}

function toggleDarkMode() {
  isDarkMode = !isDarkMode;
  document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
  localStorage.setItem('darkMode', isDarkMode);
  
  // Update ARIA label
  darkModeToggle.setAttribute('aria-label', 
    isDarkMode ? 'Switch to light mode' : 'Switch to dark mode'
  );
}

function initializeTheme() {
  const savedTheme = localStorage.getItem('darkMode');
  if (savedTheme !== null) {
    isDarkMode = savedTheme === 'true';
    document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
  } else {
    // Check system preference
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      isDarkMode = true;
      document.documentElement.setAttribute('data-theme', 'dark');
    }
  }
}

function handleScroll() {
  const scrollY = window.scrollY;
  const windowHeight = window.innerHeight;
  const documentHeight = document.documentElement.scrollHeight;
  
  // Update navigation style
  if (scrollY > 50) {
    navbar.classList.add('scrolled');
  } else {
    navbar.classList.remove('scrolled');
  }
  
  // Update progress bar
  const progress = (scrollY / (documentHeight - windowHeight)) * 100;
  progressBar.style.width = `${Math.min(progress, 100)}%`;
  
  // Show/hide sticky CTA
  if (scrollY > windowHeight * 2) {
    stickyCta?.classList.add('show');
  }
  
  // Scroll animations
  updateScrollAnimations();
}

function handleResize() {
  // Close mobile menu on resize
  if (window.innerWidth >= 1024) {
    navMenu.classList.remove('active');
    hamburger.classList.remove('active');
    document.body.style.overflow = '';
  }
  
  // Reinitialize particles
  if (particles) {
    initializeParticles();
  }
}

function handleKeyboard(e) {
  // Escape key closes modals
  if (e.key === 'Escape') {
    closeAllModals();
  }
  
  // Enter key on testimonial dots
  if (e.key === 'Enter' && e.target.classList.contains('dot')) {
    const slideIndex = parseInt(e.target.dataset.slide);
    showTestimonial(slideIndex);
  }
}

function initializeScrollProgress() {
  const progressBar = document.getElementById('progressBar');
  if (!progressBar) return;
  
  window.addEventListener('scroll', () => {
    const scrolled = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
    progressBar.style.width = Math.min(scrolled, 100) + '%';
  });
}

function initializeStickyCTA() {
  const stickyCTA = document.getElementById('stickyCta');
  if (!stickyCTA) return;
  
  let isVisible = false;
  
  function checkVisibility() {
    const shouldShow = window.scrollY > window.innerHeight * 1.5;
    
    if (shouldShow && !isVisible) {
      stickyCTA.classList.add('show');
      isVisible = true;
    } else if (!shouldShow && isVisible) {
      stickyCTA.classList.remove('show');
      isVisible = false;
    }
  }
  
  window.addEventListener('scroll', throttle(checkVisibility, 100));
}

function closeStickyCTA() {
  stickyCta?.classList.remove('show');
  localStorage.setItem('stickyCTAClosed', 'true');
}

function initializeParticles() {
  if (!particles) return;
  
  // Clear existing particles
  particles.innerHTML = '';
  
  const particleCount = Math.min(50, Math.floor(window.innerWidth / 20));
  
  for (let i = 0; i < particleCount; i++) {
    createParticle();
  }
}

function createParticle() {
  const particle = document.createElement('div');
  particle.className = 'particle';
  
  // Random position
  particle.style.left = Math.random() * 100 + '%';
  particle.style.top = Math.random() * 100 + '%';
  
  // Random animation delay
  particle.style.animationDelay = Math.random() * 6 + 's';
  
  // Random size
  const size = Math.random() * 4 + 2;
  particle.style.width = size + 'px';
  particle.style.height = size + 'px';
  
  particles.appendChild(particle);
}

function initializeScrollAnimations() {
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate');
      }
    });
  }, observerOptions);
  
  // Observe all scroll-animate elements
  document.querySelectorAll('.scroll-animate').forEach(el => {
    observer.observe(el);
  });
}

function updateScrollAnimations() {
  const elements = document.querySelectorAll('.scroll-animate:not(.animate)');
  elements.forEach(element => {
    const rect = element.getBoundingClientRect();
    if (rect.top < window.innerHeight * 0.8) {
      element.classList.add('animate');
    }
  });
}

function initializeCounters() {
  const counters = document.querySelectorAll('[data-count]');
  const observerOptions = {
    threshold: 0.5
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        animateCounter(entry.target);
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);
  
  counters.forEach(counter => observer.observe(counter));
}

function animateCounter(element) {
  const target = parseFloat(element.dataset.count);
  const duration = 2000; // 2 seconds
  const step = target / (duration / 16); // 60fps
  let current = 0;
  
  const timer = setInterval(() => {
    current += step;
    if (current >= target) {
      current = target;
      clearInterval(timer);
    }
    
    // Format number based on size
    let displayValue;
    if (target >= 1000000) {
      displayValue = (current / 1000000).toFixed(1) + 'M';
    } else if (target >= 1000) {
      displayValue = (current / 1000).toFixed(1) + 'K';
    } else {
      displayValue = Math.floor(current);
    }
    
    element.textContent = displayValue;
  }, 16);
}

function initializeTestimonialCarousel() {
  const testimonials = document.querySelectorAll('.testimonial-card');
  const dots = document.querySelectorAll('.dot');
  
  if (testimonials.length === 0) return;
  
  function showTestimonial(index) {
    // Hide all testimonials
    testimonials.forEach(testimonial => {
      testimonial.classList.remove('active');
    });
    
    // Update dots
    dots.forEach(dot => {
      dot.classList.remove('active');
      dot.setAttribute('aria-selected', 'false');
    });
    
    // Show current testimonial
    if (testimonials[index]) {
      testimonials[index].classList.add('active');
    }
    
    if (dots[index]) {
      dots[index].classList.add('active');
      dots[index].setAttribute('aria-selected', 'true');
    }
    
    currentTestimonial = index;
  }
  
  function nextTestimonial() {
    const next = (currentTestimonial + 1) % testimonials.length;
    showTestimonial(next);
  }
  
  // Dot click handlers
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => showTestimonial(index));
  });
  
  // Auto-rotate testimonials
  testimonialInterval = setInterval(nextTestimonial, 5000);
  
  // Pause on hover
  const carousel = document.getElementById('testimonialsCarousel');
  if (carousel) {
    carousel.addEventListener('mouseenter', () => {
      clearInterval(testimonialInterval);
    });
    
    carousel.addEventListener('mouseleave', () => {
      testimonialInterval = setInterval(nextTestimonial, 5000);
    });
  }
  
  // Initialize first testimonial
  showTestimonial(0);
}

function initializeFAQ() {
  const faqQuestions = document.querySelectorAll('.faq-question');
  
  faqQuestions.forEach(question => {
    question.addEventListener('click', () => {
      const faqItem = question.parentElement;
      const faqAnswer = faqItem.querySelector('.faq-answer');
      const isOpen = question.getAttribute('aria-expanded') === 'true';
      
      // Close all other FAQ items
      faqQuestions.forEach(otherQuestion => {
        if (otherQuestion !== question) {
          otherQuestion.setAttribute('aria-expanded', 'false');
          otherQuestion.parentElement.querySelector('.faq-answer').classList.remove('active');
        }
      });
      
      // Toggle current FAQ item
      question.setAttribute('aria-expanded', !isOpen);
      faqAnswer.classList.toggle('active', !isOpen);
    });
  });
}

function initializeForms() {
  const forms = document.querySelectorAll('form');
  
  forms.forEach(form => {
    form.addEventListener('submit', handleFormSubmit);
    
    // Real-time validation
    const inputs = form.querySelectorAll('input[required]');
    inputs.forEach(input => {
      input.addEventListener('blur', () => validateField(input));
      input.addEventListener('input', () => clearFieldError(input));
    });
  });
}

function handleFormSubmit(e) {
  e.preventDefault();
  
  const form = e.target;
  const formData = new FormData(form);
  let isValid = true;
  
  // Validate all required fields
  const requiredFields = form.querySelectorAll('input[required]');
  requiredFields.forEach(field => {
    if (!validateField(field)) {
      isValid = false;
    }
  });
  
  if (!isValid) return;
  
  // Show loading state
  const submitButton = form.querySelector('button[type="submit"]');
  const originalText = submitButton.textContent;
  submitButton.textContent = 'Chargement...';
  submitButton.disabled = true;
  
  // Simulate API call
  setTimeout(() => {
    // Reset form
    form.reset();
    
    // Reset button
    submitButton.textContent = originalText;
    submitButton.disabled = false;
    
    // Close modal if it's a modal form
    if (form.closest('.modal')) {
      closeAllModals();
    }
    
    // Show success message
    showNotification('Inscription réussie ! Bienvenue sur YouzinElegancia.', 'success');
  }, 1500);
}

function validateField(field) {
  const value = field.value.trim();
  const type = field.type;
  let isValid = true;
  let errorMessage = '';
  
  // Required field validation
  if (field.required && !value) {
    isValid = false;
    errorMessage = 'Ce champ est requis.';
  }
  
  // Email validation
  else if (type === 'email' && value) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(value)) {
      isValid = false;
      errorMessage = 'Veuillez entrer une adresse email valide.';
    }
  }
  
  // Password validation
  else if (type === 'password' && value) {
    if (value.length < 8) {
      isValid = false;
      errorMessage = 'Le mot de passe doit contenir au moins 8 caractères.';
    }
  }
  
  // Show/hide error
  showFieldError(field, isValid ? '' : errorMessage);
  
  return isValid;
}

function showFieldError(field, message) {
  const formGroup = field.closest('.form-group');
  const errorElement = formGroup.querySelector('.error-message');
  
  if (message) {
    formGroup.classList.add('error');
    errorElement.textContent = message;
    errorElement.classList.add('show');
  } else {
    formGroup.classList.remove('error');
    errorElement.classList.remove('show');
  }
}

function clearFieldError(field) {
  const formGroup = field.closest('.form-group');
  const errorElement = formGroup.querySelector('.error-message');
  
  formGroup.classList.remove('error');
  errorElement.classList.remove('show');
}

function openModal(modalType) {
  const modal = document.getElementById(`${modalType}Modal`);
  if (modal) {
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
    
    // Focus first input
    const firstInput = modal.querySelector('input');
    if (firstInput) {
      setTimeout(() => firstInput.focus(), 100);
    }
  }
}

function closeModal(modalType) {
  const modal = document.getElementById(`${modalType}Modal`);
  if (modal) {
    modal.classList.remove('active');
    document.body.style.overflow = '';
  }
}

function closeAllModals() {
  const modals = document.querySelectorAll('.modal');
  modals.forEach(modal => {
    modal.classList.remove('active');
  });
  document.body.style.overflow = '';
}

function openVideoModal(videoId) {
  const modal = document.getElementById('videoModal');
  const videoContainer = document.getElementById('videoContainer');
  
  if (modal && videoContainer) {
    // Create YouTube iframe
    const iframe = document.createElement('iframe');
    iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
    iframe.width = '100%';
    iframe.height = '100%';
    iframe.frameBorder = '0';
    iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
    iframe.allowFullscreen = true;
    
    videoContainer.innerHTML = '';
    videoContainer.appendChild(iframe);
    
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
}

function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `notification notification-${type}`;
  notification.textContent = message;
  
  // Styles
  Object.assign(notification.style, {
    position: 'fixed',
    top: '20px',
    right: '20px',
    padding: '16px 24px',
    borderRadius: '8px',
    color: 'white',
    fontWeight: '500',
    zIndex: '9999',
    transform: 'translateX(400px)',
    transition: 'transform 0.3s ease',
    maxWidth: '400px'
  });
  
  // Colors based on type
  const colors = {
    success: '#22c55e',
    error: '#ef4444',
    warning: '#f59e0b',
    info: '#3b82f6'
  };
  
  notification.style.backgroundColor = colors[type] || colors.info;
  
  document.body.appendChild(notification);
  
  // Animate in
  setTimeout(() => {
    notification.style.transform = 'translateX(0)';
  }, 100);
  
  // Auto remove
  setTimeout(() => {
    notification.style.transform = 'translateX(400px)';
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 300);
  }, 4000);
}

// Utility functions
function throttle(func, limit) {
  let inThrottle;
  return function() {
    const args = arguments;
    const context = this;
    if (!inThrottle) {
      func.apply(context, args);
      inThrottle = true;
      setTimeout(() => inThrottle = false, limit);
    }
  };
}

function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// Analytics and tracking (placeholder)
function trackEvent(category, action, label) {
  // Placeholder for analytics tracking
  console.log('Track Event:', { category, action, label });
}

// Error handling
window.addEventListener('error', (e) => {
  console.error('Global error:', e.error);
  // Send to error tracking service
});

window.addEventListener('unhandledrejection', (e) => {
  console.error('Unhandled promise rejection:', e.reason);
  // Send to error tracking service
});

// Performance monitoring
if ('performance' in window) {
  window.addEventListener('load', () => {
    setTimeout(() => {
      const perfData = performance.getEntriesByType('navigation')[0];
      console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart);
    }, 0);
  });
}

// Service Worker registration (for PWA)
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(registration => {
        console.log('SW registered: ', registration);
      })
      .catch(registrationError => {
        console.log('SW registration failed: ', registrationError);
      });
  });
}

// Cleanup
window.addEventListener('beforeunload', () => {
  if (testimonialInterval) {
    clearInterval(testimonialInterval);
  }
  if (particleAnimation) {
    cancelAnimationFrame(particleAnimation);
  }
});